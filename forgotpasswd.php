<?php/******************************************************************************* *   copyright				: (C) 2014 - 2018 Pro-Auction-Script *   site					: https://www.pro-auction-script.com *   Script License			: https://www.pro-auction-script.com/contents.php?show=free_license *******************************************************************************/include 'common.php';if (isset($_POST['action']) && $_POST['action'] == 'ok'){	if (isset($_POST['TPL_username']) && isset($_POST['TPL_email']))	{		$query = "SELECT email, id, name FROM " . $DBPrefix . "users WHERE nick = :username AND email = :user_email LIMIT 1";		$params = array(			array(':username', $_POST['TPL_username'], 'str'),			array(':user_email', $_POST['TPL_email'], 'str')		);		$db->query($query, $params);		if ($db->numrows() > 0)		{			$userData = $db->result();			// Generate a new random password and mail it to the user									$random_pwd = $security->genRandString(7);			$newpass = $phpass->HashPassword($random_pwd);			// send message			$ERROR = $send_email->forgot_password($userData['name'], $random_pwd, $userData['id'], $userData['email']);						// Update database			$query = "UPDATE " . $DBPrefix . "users SET password = :pass WHERE id = :user_id";			$params = array(				array(':pass', $newpass, 'str'),				array(':user_id', $userData['id'], 'int')			);			$db->query($query, $params);		}		else		{			$ERROR = $ERR['076'];		}	}	else	{		$ERROR = $ERR['112'];	}}$template->assign_vars(array(		'ERROR' => (isset($ERROR)) ? $ERROR : '',		'USERNAME' => (isset($username)) ? $username : '',		'EMAIL' => (isset($email)) ? $email : '',		'B_FB_LINK' => 'IndexFBLogin',		'B_FIRST' => (!isset($_POST['action']) || (isset($_POST['action']) && isset($ERROR)))		));include 'header.php';$template->set_filenames(array(		'body' => 'forgotpasswd.tpl'		));$template->display('body');include 'footer.php';