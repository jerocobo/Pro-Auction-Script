<?php/******************************************************************************* *   copyright				: (C) 2014 - 2018 Pro-Auction-Script *   site					: https://www.pro-auction-script.com *   Script License			: https://www.pro-auction-script.com/contents.php?show=free_license *******************************************************************************/include 'common.php';// If user is not logged in redirect to login pageif (!$user->checkAuth() && $_GET['a'] != 3){	header('location: user_login.php');	exit;}$check = (isset($_GET['a'])) ? $_GET['a'] : '';$gateway_data = $system->loadTable('gateways');if ($_GET['a'] == 1 || $_GET['a'] == 3 || $_GET['a'] == 4 || $_GET['a'] == 5 || $_GET['a'] == 6 || $_GET['a'] == 7 || $_GET['a'] == 8 || $_GET['a'] == 9 || $_GET['a'] == 10){	$query = "SELECT * FROM " . $DBPrefix . "users WHERE admin = :main_admin"; 	$params = array();	$params[] = array(':main_admin', 2, 'int');	$db->query($query, $params);	$admin_data = $db->result(); }$fees = new process_fees;switch($check){	case 1: // add to account balance		$pp_paytoemail = isset($gateway_data['paypal_address']) !='' ? $gateway_data['paypal_address'] : '';		$an_paytoid = isset($gateway_data['authnet_address']) !='' ? $gateway_data['authnet_address'] : '';		$an_paytopass = isset($gateway_data['authnet_password']) !='' ? $gateway_data['authnet_password'] : '';		$wp_paytoid = isset($gateway_data['worldpay_id']) !='' ? $gateway_data['worldpay_id'] : '';		$tc_paytoid = isset($gateway_data['toocheckout_id']) !='' ? $gateway_data['toocheckout_id'] : '';		$mb_paytoemail = isset($gateway_data['skrill_address']) !='' ? $gateway_data['skrill_address'] : '';		//Bank transfer gateway		$bank = isset($gateway_data['bank_name']) !='' ? $gateway_data['bank_name'] : '';		$bk_account = isset($gateway_data['bank_account']) !='' ? $gateway_data['bank_account'] : '';		$bk_routing = isset($gateway_data['bank_routing']) !='' ? $gateway_data['bank_routing'] : '';		//end Bank transfer gateway		/// Admin name, address, city, zip, country used for bank transfer		$name = $admin_data['name'];		$address = $admin_data['address'];		$city = $admin_data['city'];		$prov = $admin_data['prov'];		$country = $admin_data['country'];		$zip = $admin_data['zip'];		// end Admin name, address, city, zip, country		$payvalue = $system->input_money($_POST['pfval']);		$custoncode = $user->user_data['id'] . $system->SETTINGS['customcode'] . '1';		$message = sprintf($MSG['582'], $system->print_money($payvalue));		$title = $system->SETTINGS['sitename'] . ' - ' . $MSG['935'];		$fees->add_to_account($MSG['935'], 'balance', $payvalue);	break;	case 2: // pay for an item		$query = "SELECT w.id, a.title, a.shipping_cost, a.shipping_cost_additional, a.shipping, w.bid, u.paypal_email, u.authnet_id, u.authnet_pass,				u.id As uid, u.nick, a.payment, u.worldpay_id, u.toocheckout_id, u.skrill_email, w.qty, u.bank_name, u.bank_account, u.bank_routing, u.name, u.address, u.city, u.prov, u.country, u.zip				FROM " . $DBPrefix . "auctions a				LEFT JOIN " . $DBPrefix . "winners w ON (a.id = w.auction)				LEFT JOIN " . $DBPrefix . "users u ON (u.id = w.seller)				WHERE w.id = :pfval AND w.winner = :user";		$params = array(			array(':pfval', $_POST['pfval'], 'int'),			array(':user', $user->user_data['id'], 'int')		);		$db->query($query, $params);		// check its real		if ($db->numrows() < 1)		{			header('location: outstanding.php');			exit;		}		$data = $db->result();				//Bank transfer info		$name = $data['name'];		$address = $data['address'];		$city = $data['city'];		$prov = $data['prov'];		$country = $data['country'];		$zip = $data['zip'];		//end of bank transfer info				$payment = explode(', ', $data['payment']);		$pp_paytoemail = (in_array('paypal', $payment)) ? $data['paypal_email'] : '';		$extrastring = sprintf($MSG['778'], $data['uid'], $data['nick']);		$an_paytoid = (in_array('authnet', $payment)) ? $data['authnet_id'] : '';		$an_paytopass = (in_array('authnet', $payment)) ? $data['authnet_pass'] : '';		$wp_paytoid = (in_array('worldpay', $payment)) ? $data['worldpay_id'] : '';		$tc_paytoid = (in_array('toocheckout', $payment)) ? $data['toocheckout_id'] : '';		$mb_paytoemail = (in_array('skrill', $payment)) ? $data['skrill_email'] : '';				//Bank transfer gateway and info		$bank = (in_array('bank', $payment)) ? $data['bank_name'] : '';		$bk_account = (in_array('bank', $payment)) ? $data['bank_account'] : '';		$bk_routing = (in_array('bank', $payment)) ? $data['bank_routing'] : '';		//end Bank transfer gateway and info				$item_quantity = ($data['qty']);		$additional_shipping = $data['shipping_cost_additional'] * ($item_quantity - 1);		$shipping_cost = ($data['shipping'] == 1) ? ($data['shipping_cost'] + $additional_shipping) : 0; 		$payvalue = ($data['bid']);		$payvalueperitem = ($shipping_cost + ($payvalue * $item_quantity));		$custoncode = $data['id'] . $system->SETTINGS['customcode'] . '2';		$message = sprintf($MSG['581'], $system->print_money($payvalueperitem));		$title = $system->SETTINGS['sitename'] . ' - ' . $data['title'];	break;	case 3: // pay signup fee (live mode)		if (!isset($_SESSION['signup_id']) || !is_int($_SESSION['signup_id']) || $_SESSION['signup_id'] < 1 || $system->SETTINGS['fee_type'] != 2)		{			header('location: home');			exit;		}		$pp_paytoemail = isset($gateway_data['paypal_address']) !='' ? $gateway_data['paypal_address'] : '';		$an_paytoid = isset($gateway_data['authnet_address']) !='' ? $gateway_data['authnet_address'] : '';		$an_paytopass = isset($gateway_data['authnet_password']) !='' ? $gateway_data['authnet_password'] : '';		$wp_paytoid = isset($gateway_data['worldpay_id']) !='' ? $gateway_data['worldpay_id'] : '';		$tc_paytoid = isset($gateway_data['toocheckout_id']) !='' ? $gateway_data['toocheckout_id'] : '';		$mb_paytoemail = isset($gateway_data['skrill_address']) !='' ? $gateway_data['skrill_address'] : '';				//Bank transfer gateway		$bank = isset($gateway_data['bank_name']) !='' ? $gateway_data['bank_name'] : '';		$bk_account = isset($gateway_data['bank_account']) !='' ? $gateway_data['bank_account'] : '';		$bk_routing = isset($gateway_data['bank_routing']) !='' ? $gateway_data['bank_routing'] : '';				/// Admin name, address, city, zip, country used for bank transfer		$name = $admin_data['name'];		$address = $admin_data['address'];		$city = $admin_data['city'];		$prov = $admin_data['prov'];		$country = $admin_data['country'];		$zip = $admin_data['zip'];		// end Admin name, address, city, zip, country		//end Bank transfer gateway				$query = "SELECT value FROM " . $DBPrefix . "fees WHERE type = :id";		$params = array(			array(':id', 'signup_fee', 'str')		);		$db->query($query, $params);				$payvalue = $db->result();		$custoncode = $_SESSION['signup_id'] . $system->SETTINGS['customcode'] . '3';		$message = sprintf($MSG['583'], $system->print_money($payvalue));		$title = $system->SETTINGS['sitename'] . ' - ' . $MSG['430'];		$fees->add_to_account($MSG['768'], 'signup_fee', $payvalue);	break;	case 4: // pay auction fee (live mode)		if (isset($_GET['auction_id']))		{			$_SESSION['auction_id'] = intval($_GET['auction_id']);		}		if (!isset($_SESSION['auction_id']) || $_SESSION['auction_id'] < 1 || $system->SETTINGS['fee_type'] != 2)		{			header('location: home');			exit;		}		$pp_paytoemail = isset($gateway_data['paypal_address']) !='' ? $gateway_data['paypal_address'] : '';		$an_paytoid = isset($gateway_data['authnet_address']) !='' ? $gateway_data['authnet_address'] : '';		$an_paytopass = isset($gateway_data['authnet_password']) !='' ? $gateway_data['authnet_password'] : '';		$wp_paytoid = isset($gateway_data['worldpay_id']) !='' ? $gateway_data['worldpay_id'] : '';		$tc_paytoid = isset($gateway_data['toocheckout_id']) !='' ? $gateway_data['toocheckout_id'] : '';		$mb_paytoemail = isset($gateway_data['skrill_address']) !='' ? $gateway_data['skrill_address'] : '';				//Bank transfer gateway		$bank = isset($gateway_data['bank_name']) !='' ? $gateway_data['bank_name'] : '';		$bk_account = isset($gateway_data['bank_account']) !='' ? $gateway_data['bank_account'] : '';		$bk_routing = isset($gateway_data['bank_routing']) !='' ? $gateway_data['bank_routing'] : '';		/// Admin name, address, city, zip, country used for bank transfer		$name = $admin_data['name'];		$address = $admin_data['address'];		$city = $admin_data['city'];		$prov = $admin_data['prov'];		$country = $admin_data['country'];		$zip = $admin_data['zip'];		// end Admin name, address, city, zip, country		//end Bank transfer gateway				$query = "SELECT total, useracc_id FROM " . $DBPrefix . "useraccounts WHERE auc_id = :id AND user_id = :user_id";		$params = array(			array(':id', $_SESSION['auction_id'], 'int'),			array(':user_id', $user->user_data['id'], 'int')		);		$db->query($query, $params);		$data = $db->result();		$payvalue = $data['total'];		$invoice_id = $data['useracc_id'];		$custoncode = $invoice_id . $system->SETTINGS['customcode'] . '4';		$message = sprintf($MSG['590'], $system->print_money($payvalue));		$title = $system->SETTINGS['sitename'] . ' - ' . $MSG['432'];		$fees->add_to_account($MSG['432'], 'setup', $payvalue);	break;	case 5: // pay relist fee (live mode)		$pp_paytoemail = isset($gateway_data['paypal_address']) !='' ? $gateway_data['paypal_address'] : '';		$an_paytoid = isset($gateway_data['authnet_address']) !='' ? $gateway_data['authnet_address'] : '';		$an_paytopass = isset($gateway_data['authnet_password']) !='' ? $gateway_data['authnet_password'] : '';		$wp_paytoid = isset($gateway_data['worldpay_id']) !='' ? $gateway_data['worldpay_id'] : '';		$tc_paytoid = isset($gateway_data['toocheckout_id']) !='' ? $gateway_data['toocheckout_id'] : '';		$mb_paytoemail = isset($gateway_data['skrill_address']) !='' ? $gateway_data['skrill_address'] : '';				//Bank transfer gateway		$bank = isset($gateway_data['bank_name']) !='' ? $gateway_data['bank_name'] : '';		$bk_account = isset($gateway_data['bank_account']) !='' ? $gateway_data['bank_account'] : '';		$bk_routing = isset($gateway_data['bank_routing']) !='' ? $gateway_data['bank_routing'] : '';		/// Admin name, address, city, zip, country used for bank transfer		$name = $admin_data['name'];		$address = $admin_data['address'];		$city = $admin_data['city'];		$prov = $admin_data['prov'];		$country = $admin_data['country'];		$zip = $admin_data['zip'];		// end Admin name, address, city, zip, country		//end Bank transfer gateway				// number of auctions to relist		$query = "SELECT COUNT(*) FROM " . $DBPrefix . "auctions WHERE suspended = 8 AND user = :id";		$params = array(			array(':id', $user->user_data['id'], 'int')		);		$db->query($query, $params);		$count = $db->result();		// get relist fee		$query = "SELECT value FROM " . $DBPrefix . "fees WHERE type = :id";		$params = array(			array(':id', 'relist_fee', 'str')		);		$db->query($query, $params);		$relist_fee = $db->result();				$payvalue = $relist_fee * $count;		$custoncode = $user->user_data['id'] . $system->SETTINGS['customcode'] . '5';		$message = sprintf($MSG['591'], $system->print_money($payvalue));		$title = $system->SETTINGS['sitename'] . ' - ' . $MSG['437'];		$fees->add_to_account($MSG['437'], 'relist_fee', $payvalue);	break;	case 6: // pay buyer fee (live mode)		if (isset($_GET['auction_id']))		{			$_SESSION['auction_id'] = intval($_GET['auction_id']);		}		if (!isset($_SESSION['auction_id']) || $_SESSION['auction_id'] < 1 || $system->SETTINGS['fee_type'] != 2)		{			header('location: home');			exit;		}		$pp_paytoemail = isset($gateway_data['paypal_address']) !='' ? $gateway_data['paypal_address'] : '';		$an_paytoid = isset($gateway_data['authnet_address']) !='' ? $gateway_data['authnet_address'] : '';		$an_paytopass = isset($gateway_data['authnet_password']) !='' ? $gateway_data['authnet_password'] : '';		$wp_paytoid = isset($gateway_data['worldpay_id']) !='' ? $gateway_data['worldpay_id'] : '';		$tc_paytoid = isset($gateway_data['toocheckout_id']) !='' ? $gateway_data['toocheckout_id'] : '';		$mb_paytoemail = isset($gateway_data['skrill_address']) !='' ? $gateway_data['skrill_address'] : '';				//Bank transfer gateway		$bank = isset($gateway_data['bank_name']) !='' ? $gateway_data['bank_name'] : '';		$bk_account = isset($gateway_data['bank_account']) !='' ? $gateway_data['bank_account'] : '';		$bk_routing = isset($gateway_data['bank_routing']) !='' ? $gateway_data['bank_routing'] : '';		/// Admin name, address, city, zip, country used for bank transfer		$name = $admin_data['name'];		$address = $admin_data['address'];		$city = $admin_data['city'];		$prov = $admin_data['prov'];		$country = $admin_data['country'];		$zip = $admin_data['zip'];		// end Admin name, address, city, zip, country		//end Bank transfer gateway		$query = "SELECT current_bid FROM " . $DBPrefix . "auctions WHERE id = :id";		$params = array(			array(':id', $_SESSION['auction_id'], 'int')		);		$db->query($query, $params);		$final_value = $db->result();				$query = "SELECT value, fee_type FROM " . $DBPrefix . "fees WHERE type = :id";		$params = array(			array(':id', 'buyer_fee', 'str')		);		$db->query($query, $params);		$row = $db->result();				if ($row['fee_type'] == 'flat')		{			$fee_value = $row['value'];		}		else		{			$fee_value = ($row['value'] / 100) * floatval($final_value);		}		$custoncode = $_SESSION['auction_id'] . $system->SETTINGS['customcode'] . '6';		$message = sprintf($MSG['776'], $system->print_money($payvalue));		$title = $system->SETTINGS['sitename'] . ' - ' . $MSG['775'];		$fees->add_to_account($MSG['775'], 'buyer_fee', $payvalue);	break;	case 7: // pay final value fee (live mode)		if (isset($_GET['auction_id']))		{			$_SESSION['auction_id'] = intval($_GET['auction_id']);		}		if (!isset($_SESSION['auction_id']) || $_SESSION['auction_id'] < 1 || $system->SETTINGS['fee_type'] != 2)		{			header('location: home');			exit;		}		$pp_paytoemail = isset($gateway_data['paypal_address']) !='' ? $gateway_data['paypal_address'] : '';		$an_paytoid = isset($gateway_data['authnet_address']) !='' ? $gateway_data['authnet_address'] : '';		$an_paytopass = isset($gateway_data['authnet_password']) !='' ? $gateway_data['authnet_password'] : '';		$wp_paytoid = isset($gateway_data['worldpay_id']) !='' ? $gateway_data['worldpay_id'] : '';		$tc_paytoid = isset($gateway_data['toocheckout_id']) !='' ? $gateway_data['toocheckout_id'] : '';		$mb_paytoemail = isset($gateway_data['skrill_address']) !='' ? $gateway_data['skrill_address'] : '';				//Bank transfer gateway		$bank = isset($gateway_data['bank_name']) !='' ? $gateway_data['bank_name'] : '';		$bk_account = isset($gateway_data['bank_account']) !='' ? $gateway_data['bank_account'] : '';		$bk_routing = isset($gateway_data['bank_routing']) !='' ? $gateway_data['bank_routing'] : '';		/// Admin name, address, city, zip, country used for bank transfer		$name = $admin_data['name'];		$address = $admin_data['address'];		$city = $admin_data['city'];		$prov = $admin_data['prov'];		$country = $admin_data['country'];		$zip = $admin_data['zip'];		// end Admin name, address, city, zip, country		//end Bank transfer gateway		$query = "SELECT current_bid FROM " . $DBPrefix . "auctions WHERE user = :user_id AND id = :id";		$params = array(			array(':user_id', $user->user_data['id'], 'int'),			array(':id', $_SESSION['auction_id'], 'int')		);		$db->query($query, $params);		$final_value = $db->result();				$query = "SELECT * FROM " . $DBPrefix . "fees WHERE type = :id ORDER BY value ASC";		$params = array(			array(':id', 'endauc_fee', 'str')		);		$db->query($query, $params);		while ($row = $db->result())		{			if ($final_value > $row['fee_from'] && $final_value < $row['fee_to'])			{				if ($row['fee_type'] == 'flat')				{					$payvalue = $row['value'];				}				else				{					$payvalue = ($row['value'] / 100) * $final_value;				}			}		}		$custoncode = $_SESSION['auction_id'] . $system->SETTINGS['customcode'] . '7';		$message = sprintf($MSG['776'], $system->print_money($payvalue));		$title = $system->SETTINGS['sitename'] . ' - ' . $MSG['791'];		$fees->add_to_account($MSG['791'], 'endauc_fee', $payvalue);	break;	case 8:  // Pay new banner user account fee (live mode)                 $query = "SELECT value FROM " . $DBPrefix . "fees WHERE type = :id";         $params = array(			array(':id', 'banner_fee', 'str')		);		$db->query($query, $params);        $payvalue = $db->result('value');                 // Retrieve users from the database         $query = "SELECT u.*, COUNT(b.user) as count FROM " . $DBPrefix . "bannersusers u         LEFT JOIN " . $DBPrefix . "banners b ON (b.user = u.id)         GROUP BY u.id ORDER BY u.name"; 		$db->direct_query($query);         while ($row = $db->result())         {         	if($row['seller'] == $security->decrypt($_SESSION[$system->SETTINGS['sessionsname'] . '_LOGGED_IN']) && $row['paid'] == 0 && $row['newuser'] == y)             {             	$id = $row['id'];             }         }         $pp_paytoemail = isset($gateway_data['paypal_address']) !='' ? $gateway_data['paypal_address'] : '';		$an_paytoid = isset($gateway_data['authnet_address']) !='' ? $gateway_data['authnet_address'] : '';		$an_paytopass = isset($gateway_data['authnet_password']) !='' ? $gateway_data['authnet_password'] : '';		$wp_paytoid = isset($gateway_data['worldpay_id']) !='' ? $gateway_data['worldpay_id'] : '';		$tc_paytoid = isset($gateway_data['toocheckout_id']) !='' ? $gateway_data['toocheckout_id'] : '';		$mb_paytoemail = isset($gateway_data['skrill_address']) !='' ? $gateway_data['skrill_address'] : '';				//Bank transfer gateway		$bank = isset($gateway_data['bank_name']) !='' ? $gateway_data['bank_name'] : '';		$bk_account = isset($gateway_data['bank_account']) !='' ? $gateway_data['bank_account'] : '';		$bk_routing = isset($gateway_data['bank_routing']) !='' ? $gateway_data['bank_routing'] : '';		/// Admin name, address, city, zip, country used for bank transfer		$name = $admin_data['name'];		$address = $admin_data['address'];		$city = $admin_data['city'];		$prov = $admin_data['prov'];		$country = $admin_data['country'];		$zip = $admin_data['zip'];		// end Admin name, address, city, zip, country		//end Bank transfer gateway        $custoncode = $id . $system->SETTINGS['customcode'] . '8';         $message = sprintf($MSG['350_10139'], $system->print_money($payvalue));         $title = $system->SETTINGS['sitename'] . ' - ' . $MSG['350_10135'];         $fees->add_to_account($MSG['350_10135'], 'banner_fee', $payvalue);     break;     case 9: // Pay extra banner fee (live mode)         $query = "SELECT value FROM " . $DBPrefix . "fees WHERE type = :id";         $params = array(			array(':id', 'ex_banner_fee', 'str')		);		$db->query($query, $params);        $payvalue = $db->result('value');                 // Retrieve users from the database         $query = "SELECT * FROM " . $DBPrefix . "bannersusers WHERE id = " . intval($_POST['pfval']);         $params = array(			array(':id', 'ex_banner_fee', 'str')		);		$db->query($query, $params);       	while ($row = $db->result())         {         	if($row['seller'] == $security->decrypt($_SESSION[$system->SETTINGS['sessionsname'] . '_LOGGED_IN']) && $row['paid'] == 1 && $row['newuser'] == n)             {                 $id = $row['id'];             }         }         $pp_paytoemail = isset($gateway_data['paypal_address']) !='' ? $gateway_data['paypal_address'] : '';		$an_paytoid = isset($gateway_data['authnet_address']) !='' ? $gateway_data['authnet_address'] : '';		$an_paytopass = isset($gateway_data['authnet_password']) !='' ? $gateway_data['authnet_password'] : '';		$wp_paytoid = isset($gateway_data['worldpay_id']) !='' ? $gateway_data['worldpay_id'] : '';		$tc_paytoid = isset($gateway_data['toocheckout_id']) !='' ? $gateway_data['toocheckout_id'] : '';		$mb_paytoemail = isset($gateway_data['skrill_address']) !='' ? $gateway_data['skrill_address'] : '';				//Bank transfer gateway		$bank = isset($gateway_data['bank_name']) !='' ? $gateway_data['bank_name'] : '';		$bk_account = isset($gateway_data['bank_account']) !='' ? $gateway_data['bank_account'] : '';		$bk_routing = isset($gateway_data['bank_routing']) !='' ? $gateway_data['bank_routing'] : '';		/// Admin name, address, city, zip, country used for bank transfer		$name = $admin_data['name'];		$address = $admin_data['address'];		$city = $admin_data['city'];		$prov = $admin_data['prov'];		$country = $admin_data['country'];		$zip = $admin_data['zip'];		// end Admin name, address, city, zip, country		//end Bank transfer gateway            $custoncode = $id . $system->SETTINGS['customcode'] . '9';         $message = sprintf($MSG['350_10138'], $system->print_money($payvalue));         $title = $system->SETTINGS['sitename'] . ' - ' . $MSG['350_10136'];         $fees->add_to_account($MSG['350_10136'], 'banner_fee', $payvalue);     break;	case 10:		//Digital item gateway		$query = "SELECT w.id, w.paid, a.title, w.qty, w.bid, u.paypal_email, u.authnet_id, u.authnet_pass,				u.id As uid, u.nick, a.payment, u.worldpay_id, u.toocheckout_id, u.skrill_email, u.bank_name, u.bank_account, u.bank_routing				FROM " . $DBPrefix . "auctions a				LEFT JOIN " . $DBPrefix . "winners w ON (a.id = w.auction)				LEFT JOIN " . $DBPrefix . "users u ON (u.id = w.seller)				WHERE paid = 0 AND w.id = :pfval AND w.winner = :user";		$params = array(			array(':pfval', $_POST['pfval'], 'int'),			array(':user', $user->user_data['id'], 'int')		);		$db->query($query, $params);		// check its real		if ($db->numrows() < 1)		{			header('location: outstanding.php');			exit;		}		$data = $db->result();		$payment = explode(', ', $data['payment']);				$pp_paytoemail = (in_array('paypal', $payment)) ? $data['paypal_email'] : '';		$extrastring = sprintf($MSG['778'], $data['uid'], $data['nick']);		$an_paytoid = (in_array('authnet', $payment)) ? $data['authnet_id'] : '';		$an_paytopass = (in_array('authnet', $payment)) ? $data['authnet_pass'] : '';		$wp_paytoid = (in_array('worldpay', $payment)) ? $data['worldpay_id'] : '';		$tc_paytoid = (in_array('toocheckout', $payment)) ? $data['toocheckout_id'] : '';		$mb_paytoemail = (in_array('skrill', $payment)) ? $data['skrill_email'] : '';		//Bank transfer gateway		$bank = $gateway_data['bank_name'];		$bk_account = $gateway_data['bank_account'];		$bk_routing = $gateway_data['bank_routing'];		//end Bank transfer gateway		/// Admin name, address, city, zip, country used for bank transfer		$name = $admin_data['name'];		$address = $admin_data['address'];		$city = $admin_data['city'];		$prov = $admin_data['prov'];		$country = $admin_data['country'];		$zip = $admin_data['zip'];		// end Admin name, address, city, zip, country		$mo_payment = (in_array('0', $payment));		$paypalvalue= $data['bid'];		$payvalue = $data['bid'];		$item_quantity = 1; 		$shipping_cost = '0.00'; 		$total = $system->print_money($payvalue );		$custoncode = $data['id'] . $system->SETTINGS['customcode'] . '10';		$message = sprintf($MSG['581'], $system->print_money($payvalue));		$title = $system->SETTINGS['sitename'] . ' - ' . $data['title'];	break;}function gatewayLink($gateway = false){	global $system;		//Payment gateway links for live and testing	if($gateway == 'paypal')	{		if ($system->SETTINGS['paypal_sandbox'] == 'y') {			$str = 'https://www.sandbox.paypal.com/cgi-bin/webscr';		}		else {			$str = 'https://www.paypal.com/cgi-bin/webscr';		}	}	elseif($gateway == 'authnet')	{		if ($system->SETTINGS['authnet_sandbox'] == 'y') {			$str = 'https://test.authorize.net/gateway/transact.dll';		}		else {			$str = 'https://secure.authorize.net/gateway/transact.dll';		}	}	elseif($gateway == 'worldpay')	{		if ($system->SETTINGS['worldpay_sandbox'] == 'y') {			$str = 'https://secure-test.worldpay.com/wcc/purchase';		}		else {			$str = 'https://select.worldpay.com/wcc/purchase';		}	}	elseif($gateway == 'skrill')	{		if ($system->SETTINGS['skrill_sandbox'] == 'y') {			$str = 'http://www.moneybookers.com/app/test_payment.pl';		}		else {			$str = 'https://www.moneybookers.com/app/payment.pl';		}	}	elseif($gateway == 'checkout')	{		if ($system->SETTINGS['checkout_sandbox'] == 'y') {			$str = 'https://sandbox.2checkout.com/checkout/purchase';		}		else 		{			$str = 'https://www.2checkout.com/2co/buyer/purchase';		}	}	return $str;}$sequence = rand(1, 1000);$timestamp = $system->CTIME;$template->assign_vars(array(		'TOP_MESSAGE' => $message,		// enabled gateways		'B_ENPAYPAL' => ($gateway_data['paypal_active'] == 1 && !empty($pp_paytoemail)),		'B_ENAUTHNET' => ($gateway_data['authnet_active'] == 1 && !empty($an_paytoid) && !empty($an_paytopass)),		'B_ENWORLDPAY' => ($gateway_data['worldpay_active'] == 1 && !empty($wp_paytoid)),		'B_ENTOOCHECK' => ($gateway_data['toocheckout_active'] == 1 && !empty($tc_paytoid)),		'B_ENSKRILL' => ($gateway_data['skrill_active'] == 1 && !empty($mb_paytoemail)),		'B_BANK_TRANSFER' => ($gateway_data['bank_active'] == 1 && !empty($bank) && !empty($bk_account) && !empty($bk_routing)),		//bank transfer        'NAME' => $name,		'ADRESS' => $address,		'CITY' => $city,		'PROV' => $prov,		'COUNTRY' => $country,		'ZIP' => $zip,		'BANK' => $bank,		'BANK_ACCOUNT' => $bk_account,		'BANK_ROUTING' => $bk_routing,		// paypal		'PP_PAYTOEMAIL' => $pp_paytoemail,		'SHIPPING_COST' => $shipping_cost,         'ITEM_QUANTITY' => $item_quantity,        'PP_LINK' => gatewayLink('paypal'),		// authorize.net		'AN_PAYTOID' => $an_paytoid,		'AN_TIMESTAMP' => $timestamp,		'AN_PAYTOPASS' => $an_paytopass,		'AN_KEY' => ($gateway_data['authnet_active'] == 1) ? $fees->hmac($an_paytopass, $an_paytoid . "^" . $sequence . "^" . $timestamp . "^" . $payvalue . "^" . $system->SETTINGS['currency']) : '',		'AN_SEQUENCE' => $sequence,		'AZ_LINK' => gatewayLink('authnet'),		// worldpay		'WP_PAYTOID' => $wp_paytoid,		'WP_LINK' => gatewayLink('worldpay'),		// 2checkout		'TC_PAYTOID' => $tc_paytoid,		'CO_LINK' => gatewayLink('checkout'),		// skrill		'MB_PAYTOEMAIL' => $mb_paytoemail,		'SK_LINK' => gatewayLink('skrill'),		// item values		'PAY_VAL' => $payvalue,		'CURRENCY' => $system->SETTINGS['currency'],		'TITLE' => $title,		'CUSTOM_CODE' => $custoncode,		'TIMESTAMP' => $timestamp,		'SSL' => $system->SETTINGS['https'] == 'y',		'TOUSER_STRING' => (isset($extrastring)) ? $extrastring : '',		'B_TOUSER' => ($_GET['a'] == 2),		));include 'header.php';$template->set_filenames(array(		'body' => 'pay.tpl'		));$template->display('body');include 'footer.php';