<?php/******************************************************************************* *   copyright				: (C) 2014 - 2018 Pro-Auction-Script *   site					: https://www.pro-auction-script.com *   Script License			: https://www.pro-auction-script.com/contents.php?show=free_license *******************************************************************************/include 'common.php';// check recaptcha is enabled$spam_html = '';if ($system->SETTINGS['spam_register'] == 2){	include PLUGIN_PATH . 'captcha/recaptchalib.php';	if(!$_POST["g-recaptcha-response"])	{		$capcha_text = '<script src="https://www.google.com/recaptcha/api.js"></script> <div class="g-recaptcha" data-sitekey="' . $system->SETTINGS['recaptcha_public'] . '"></div>';	}	elseif(isset($_POST["g-recaptcha-response"]))	{		$resp = recaptcha_check_answer($system->SETTINGS['recaptcha_private'], $_SERVER["REMOTE_ADDR"], $_POST["g-recaptcha-response"]);	}}elseif ($system->SETTINGS['spam_register'] == 1){	include PLUGIN_PATH . 'captcha/securimage.php';		$resp = new Securimage();	$spam_html = $resp->show_html();}if (isset($_GET['id'])){	$_SESSION['CURRENT_ITEM'] = $_GET['id'];}$id = intval($_SESSION['CURRENT_ITEM']);$TPL_error_text = '';$emailsent = 1;// Get item data$query = "SELECT title, category FROM " . $DBPrefix . "auctions WHERE id = :auc_id";$params = array(	array(':auc_id', $id, 'int'));$db->query($query, $params);if ($db->numrows() > 0){	$TPL_item_title = $db->result('title');}if (isset($_POST['action']) && $_POST['action'] == 'sendmail'){	// check errors	if (empty($_POST['sender_name']) || empty($_POST['sender_email']) || empty($_POST['friend_name']) || empty($_POST['friend_email']))	{		$TPL_error_text = $ERR['031'];	}	elseif (!preg_match('/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+([\.][a-z0-9-]+)+$/i', $_POST['sender_email']) || !preg_match('/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+([\.][a-z0-9-]+)+$/i', $_POST['friend_email']))	{		$TPL_error_text = $ERR['008'];	}	elseif ($system->SETTINGS['spam_sendtofriend'] == 2 && !$resp)	{		$TPL_error_text = $MSG['752'];	}	elseif ($system->SETTINGS['spam_sendtofriend'] == 1 && !$resp->check($_POST['captcha_code']))	{		$TPL_error_text = $MSG['752'];	}		if (!empty($TPL_error_text))	{		$emailsent = 1;	}	else	{		$emailsent = 0;		$send_email->send_friend_email($_POST['sender_name'], $_POST['sender_email'], $_POST['sender_comment'], $_POST['friend_name'], $TPL_item_title, $id, $_POST['friend_email']);	}}$template->assign_vars(array(		'ERROR' => $TPL_error_text,		'SEO' => generate_seo_link($TPL_item_title) . '-' . intval($id),		'CAPTCHATYPE' => $system->SETTINGS['spam_register'],		'CAPCHA' => ($system->SETTINGS['spam_register'] == 2) ? $capcha_text : $spam_html,		'TITLE' => $TPL_item_title,		'FRIEND_NAME' => (isset($_POST['friend_name'])) ? $system->cleanvars($_POST['friend_name']) : '',		'FRIEND_EMAIL' => (isset($_POST['friend_email'])) ?  $system->cleanvars($_POST['friend_email']) : '',		'YOUR_NAME' => ($user->logged_in) ? $system->cleanvars($user->user_data['name']) : '',		'YOUR_EMAIL' => ($user->logged_in) ? $system->cleanvars($user->user_data['email']) : '',		'B_FB_LINK' => 'IndexFBLogin',		'COMMENT' => (isset($_POST['sender_comment'])) ? $system->cleanvars($_POST['sender_comment']) : '',		'EMAILSENT' => $emailsent		));include 'header.php';$template->set_filenames(array(		'body' => 'friend.tpl'		));$template->display('body');include 'footer.php';